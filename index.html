<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard</title>
  <style>
    body {
      margin: 0;
      font-family: 'Arial', sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background: #87CEEB;
      overflow: hidden;
    }
    .container {
      background: white;
      border-radius: 10px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      display: flex;
      overflow: hidden;
      width: 80%;
      max-width: 1200px;
      height: 80%;
      max-height: 800px;
      padding: 20px;
      box-sizing: border-box;
      position: relative;
      animation: fadeInContainer 1s ease-in-out forwards;
    }
    @keyframes fadeInContainer {
      from {
        opacity: 0;
        transform: scale(0.95);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }
    .sidebar {
      width: 250px;
      background: #1E90FF;
      color: white;
      padding: 1em;
      border-radius: 10px 0 0 10px;
      display: flex;
      flex-direction: column;
      align-items: center;
      overflow-y: auto;
      animation: slideInSidebar 1s ease-in-out forwards;
    }
    @keyframes slideInSidebar {
      from {
        opacity: 0;
        transform: translateX(-100%);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }
    .sidebar h2 {
      text-align: center;
      margin-bottom: 1em;
    }
    .sidebar select {
      width: 100%;
      padding: 0.75em 1em;
      border-radius: 5px;
      border: none;
      font-size: 1em;
      background-color: white;
      color: black;
      transition: background-color 0.3s, color 0.3s;
      flex-grow: 1;
      margin-bottom: 1em;
      animation: fadeInSelect 1s ease-in-out forwards;
    }
    @keyframes fadeInSelect {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }
    .sidebar select option {
      padding: 0.5em;
    }
    .sidebar select option:hover {
      background-color: #1C86EE;
      color: white;
    }
    .sidebar button {
      width: 100%;
      padding: 0.75em 1em;
      border: none;
      border-radius: 5px;
      margin-top: 0.5em;
      background: #1C86EE;
      color: white;
      font-size: 1em;
      cursor: pointer;
      transition: background 0.3s;
    }
    .sidebar button:hover {
      background: #1A78D7;
    }
    .content {
      flex: 1;
      padding: 2em;
      display: flex;
      flex-direction: column;
      background: white;
      border-radius: 0 10px 10px 0;
      overflow-y: auto;
      animation: fadeInContent 1s ease-in-out forwards;
    }
    @keyframes fadeInContent {
      from {
        opacity: 0;
        transform: translateX(100%);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }
    .tabs {
      display: flex;
      border-bottom: 1px solid #ccc;
      padding-bottom: 1em;
      margin-bottom: 1em;
      animation: fadeInTabs 1s ease-in-out forwards;
    }
    @keyframes fadeInTabs {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }
    .tabs button {
      flex: 1;
      padding: 1em;
      border: none;
      background: #f0f2f5;
      cursor: pointer;
      transition: background 0.3s;
      border-radius: 10px 10px 0 0;
      display: none; /* Hidden by default */
    }
    .tabs button:hover, .tabs button.active {
      background: #e0e0e0;
    }
    .tabs button.always-visible {
      display: block; /* Always visible tabs */
    }
    .tab-content {
      flex: 1;
      padding: 2em;
      background: white;
      border-radius: 0 0 10px 10px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      display: none;
      overflow-y: auto;
      animation: fadeInTabContent 1s ease-in-out forwards;
    }
    .tab-content.active {
      display: block;
    }
    @keyframes fadeInTabContent {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }
    .sub-tabs {
      display: flex;
      border-bottom: 1px solid #ccc;
      padding-bottom: 1em;
      margin-bottom: 1em;
      animation: fadeInSubTabs 1s ease-in-out forwards;
    }
    @keyframes fadeInSubTabs {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }
    .sub-tabs button {
      flex: 1;
      padding: 1em;
      border: none;
      background: #f0f2f5;
      cursor: pointer;
      transition: background 0.3s;
      border-radius: 10px 10px 0 0;
    }
    .sub-tabs button:hover, .sub-tabs button.active {
      background: #e0e0e0;
    }
    .sub-tab-content {
      display: none;
      animation: fadeInSubTabContent 1s ease-in-out forwards;
    }
    .sub-tab-content.active {
      display: block;
    }
    @keyframes fadeInSubTabContent {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }
    .tutorial-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      justify-content: center;
      align-items: center;
      color: white;
      font-size: 1.2em;
      padding: 2em;
      box-sizing: border-box;
      z-index: 10;
      text-align: center;
      animation: fadeInTutorial 1s ease-in-out forwards;
    }
    @keyframes fadeInTutorial {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }
    .tutorial-overlay button {
      margin-top: 1em;
      padding: 0.5em 1em;
      border: none;
      background: #1E90FF;
      color: white;
      border-radius: 5px;
      cursor: pointer;
      transition: background 0.3s;
    }
    .tutorial-overlay button:hover {
      background: #1C86EE;
    }
    .form-group {
      margin-bottom: 1em;
    }
    .form-group label {
      display: block;
      margin-bottom: 0.5em;
      font-weight: bold;
    }
    .form-group select, .form-group input {
      width: 100%;
      padding: 0.5em;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    .form-group input[type="checkbox"] {
      width: auto;
      display: inline-block;
      margin-left: 0.5em;
    }
    .form-group button {
      padding: 0.75em 1em;
      border: none;
      border-radius: 5px;
      background: #1C86EE;
      color: white;
      font-size: 1em;
      cursor: pointer;
      transition: background 0.3s;
      margin-top: 1em;
    }
    .form-group button:hover {
      background: #1A78D7;
    }
    .form-group .xyz-coordinates, .form-group .keycard-details {
      display: none;
      margin-top: 1em;
    }
    .form-group .xyz-coordinates input, .form-group .keycard-details input {
      width: calc(33.333% - 1em);
      margin-right: 1em;
      display: inline-block;
    }
    .form-group .xyz-coordinates input:last-child, .form-group .keycard-details input:last-child {
      margin-right: 0;
    }
  </style>
</head>
<body>
<div class="container">
  <div class="sidebar">
    <h2>Remote Admin Extended</h2>
    <select id="player-select" size="20" multiple onchange="togglePlayerTabs()">
      <option>No Players</option>
    </select>
    <button onclick="selectAllPlayers()">Select All</button>
    <button onclick="unselectAllPlayers()">Unselect All</button>
  </div>
  <div class="content">
    <div class="tabs">
      <button class="player-tab" onclick="showTab(event, 'tab-player')" style="display:none;">Player</button>
      <button class="always-visible active" onclick="showTab(event, 'tab-administration')">Administration</button>
      <button class="always-visible" onclick="showTab(event, 'tab-map-control')">Map Control</button>
      <button class="always-visible" onclick="showTab(event, 'tab-patreon-features')">Patreon Features</button>
      <button class="player-only" onclick="showTab(event, 'tab-roleplay')">Roleplay</button>
    </div>
    <div id="tab-player" class="tab-content">
      <h2>Player</h2>
      <div class="sub-tabs">
        <button class="active" onclick="showSubTab(event, 'sub-tab-info')">Info</button>
        <button onclick="showSubTab(event, 'sub-tab-role-management')">Role Management</button>
        <button onclick="showSubTab(event, 'sub-tab-inventory')">Inventory</button>
      </div>
      <div id="sub-tab-info" class="sub-tab-content active">
        <div class="form-group">
          <label for="customi-input">CustomI:</label>
          <input type="text" id="customi-input" placeholder="Enter CustomI">
        </div>
      </div>
      <div id="sub-tab-role-management" class="sub-tab-content">
        <div class="form-group">
          <label for="role-type">Role Type:</label>
          <select id="role-type">
            <option value="ClassD">ClassD</option>
            <option value="Scientist">Scientist</option>
            <option value="Guard">Guard</option>
            <option value="SCP">SCP</option>
            <option value="Tutorial">Tutorial</option>
          </select>
        </div>
        <div class="form-group">
          <label for="spawn-locations">Spawn Locations:</label>
          <select id="spawn-locations" onchange="toggleXYZFields()">
            <option value="LightContainment" selected>Light Containment</option>
            <option value="HeavyContainment">Heavy Containment</option>
            <option value="EntranceZone">Entrance Zone</option>
            <option value="Surface">Surface</option>
            <option value="Custom">Custom</option>
          </select>
        </div>
        <div class="form-group xyz-coordinates" id="xyz-coordinates">
          <label for="x-coordinate">X:</label>
          <input type="number" id="x-coordinate" placeholder="X">
          <label for="y-coordinate">Y:</label>
          <input type="number" id="y-coordinate" placeholder="Y">
          <label for="z-coordinate">Z:</label>
          <input type="number" id="z-coordinate" placeholder="Z">
        </div>
        <div class="form-group">
          <label for="is-cuffed">Is Cuffed:</label>
          <input type="checkbox" id="is-cuffed">
        </div>
        <div class="form-group">
          <button onclick="setRole()">Set Role</button>
        </div>
      </div>
      <div id="sub-tab-inventory" class="sub-tab-content">
        <div class="form-group">
          <label for="inventory">Inventory:</label>
          <select id="inventory">
            <option value="Default">Default</option>
            <option value="BaseItems">Base Items</option>
            <option value="None">None</option>
            <option value="UseInventoryManagement">Use InventoryManagement</option>
          </select>
        </div>
        <div class="form-group keycard-details" id="keycard-details">
          <label for="keycard-name">Keycard Name:</label>
          <input type="text" id="keycard-name" placeholder="Keycard Name (default is player's name)">
          <label for="keycard-position">Keycard Position:</label>
          <input type="text" id="keycard-position" placeholder="Position">
          <label for="keycard-permissions">Keycard Permissions:</label>
          <select id="keycard-permissions" multiple>
            <option value="None">None</option>
            <option value="Low Level Containment">Low Level Containment</option>
            <option value="Medium Level Containment">Medium Level Containment</option>
            <option value="High Level Containment">High Level Containment</option>
            <option value="Security 1">Security 1</option>
            <option value="Security 2">Security 2</option>
            <option value="Engineering">Engineering</option>
            <option value="Checkpoint Access">Checkpoint Access</option>
            <option value="Gate Access">Gate Access</option>
            <option value="Administration">Administration</option>
            <option value="High Administration">High Administration</option>
          </select>
        </div>
      </div>
    </div>
    <div id="tab-roleplay" class="tab-content">
      <h2>Roleplay</h2>
      <p>Content for roleplay goes here.</p>
    </div>
    <div id="tab-administration" class="tab-content active">
      <h2>Administration</h2>
      <p>Content for administration goes here.</p>
    </div>
    <div id="tab-map-control" class="tab-content">
      <h2>Map Control</h2>
      <p>Content for map control goes here.</p>
    </div>
    <div id="tab-inventory-management" class="tab-content">
      <h2>Inventory Management</h2>
      <p>Content for inventory management goes here.</p>
    </div>
    <div id="tab-patreon-features" class="tab-content">
      <h2>Patreon Features</h2>
      <p>Content for patreon features goes here.</p>
    </div>
  </div>
  <div class="tutorial-overlay" id="tutorial">
    <div>
      <h2>Welcome to the Dashboard</h2>
      <p>Use the tabs to navigate between different sections of the dashboard. The "Players" list on the left shows the active players. Click on any player to view more details.</p>
      <button onclick="skipTutorial()">Skip Tutorial</button>
    </div>
  </div>
</div>
<script>
  function showTab(event, tabId) {
    // Hide all tab contents
    const tabContents = document.querySelectorAll('.tab-content');
    tabContents.forEach(content => content.classList.remove('active'));

    // Remove active class from all tab buttons
    const tabButtons = document.querySelectorAll('.tabs button');
    tabButtons.forEach(button => button.classList.remove('active'));

    // Show the clicked tab content
    document.getElementById(tabId).classList.add('active');

    // Set the clicked tab button as active
    event.currentTarget.classList.add('active');
  }

  function showSubTab(event, subTabId) {
    // Hide all sub-tab contents
    const subTabContents = document.querySelectorAll('.sub-tab-content');
    subTabContents.forEach(content => content.classList.remove('active'));

    // Remove active class from all sub-tab buttons
    const subTabButtons = document.querySelectorAll('.sub-tabs button');
    subTabButtons.forEach(button => button.classList.remove('active'));

    // Show the clicked sub-tab content
    document.getElementById(subTabId).classList.add('active');

    // Set the clicked sub-tab button as active
    event.currentTarget.classList.add('active');
  }

  function skipTutorial() {
    document.getElementById('tutorial').style.display = 'none';
  }

  function selectAllPlayers() {
    const playerSelect = document.getElementById('player-select');
    for (let i = 0; i < playerSelect.options.length; i++) {
      playerSelect.options[i].selected = true;
    }
    togglePlayerTabs();
  }

  function unselectAllPlayers() {
    const playerSelect = document.getElementById('player-select');
    for (let i = 0; i < playerSelect.options.length; i++) {
      playerSelect.options[i].selected = false;
    }
    togglePlayerTabs();
  }

  function togglePlayerTabs() {
    const playerSelect = document.getElementById('player-select');
    const playerTab = document.querySelector('.player-tab');
    const playerOnlyTabs = document.querySelectorAll('.player-only');

    if (playerSelect.selectedOptions.length > 0) {
      playerTab.style.display = 'block';
      playerOnlyTabs.forEach(tab => tab.style.display = 'block');
      showTab({ currentTarget: playerTab }, 'tab-player');
    } else {
      playerTab.style.display = 'none';
      playerOnlyTabs.forEach(tab => tab.style.display = 'none');
      // Switch to another tab if no player is selected and Player tab is active
      if (document.getElementById('tab-player').classList.contains('active')) {
        showTab({ currentTarget: document.querySelector('.tabs button.always-visible') }, 'tab-administration');
      }
    }
  }

  function toggleXYZFields() {
    const spawnLocations = document.getElementById('spawn-locations');
    const xyzCoordinates = document.getElementById('xyz-coordinates');

    if (spawnLocations.value === 'Custom') {
      xyzCoordinates.style.display = 'block';
    } else {
      xyzCoordinates.style.display = 'none';
    }
  }

  async function fetchPlayers() {
    try {
      const response = await fetch('/data');
      if (response.ok) {
        const players = await response.json();
        const select = document.getElementById('player-select');

        select.innerHTML = '';

        // Define colors for roles
        const roleColors = {
          "Scp173": "red",
          "Scp106": "red",
          "Scp049": "red",
          "Scp079": "red",
          "Scp096": "red",
          "Scp0492": "red",
          "Scp939": "red",
          "Scp3114": "red",

          "NtfSpecialist": "navy",
          "NtfCaptain": "navy",
          "NtfSergeant": "navy",
          "NtfPrivate": "navy",

          "FacilityGuard": "gray",

          "ChaosConscript": "green",
          "ChaosRifleman": "green",
          "ChaosMarauder": "green",
          "ChaosRepressor": "green",

          "Scientist": "blue",

          "ClassD": "orange",

          "Tutorial": "#FF5733"
        };

        // Group players by role
        const groupedPlayers = players.reduce((groups, player) => {
          if (!groups[player.Role]) {
            groups[player.Role] = [];
          }
          groups[player.Role].push(player);
          return groups;
        }, {});

        // Populate with new options
        Object.keys(groupedPlayers).forEach(role => {
          const optgroup = document.createElement('optgroup');
          optgroup.label = role;

          groupedPlayers[role].forEach(player => {
            const option = document.createElement('option');
            option.value = player.Id;
            option.text = `${player.Name}`;

            // Set the color based on the role
            const color = roleColors[role] || "black"; // Default color if role not found
            option.style.color = color;

            optgroup.appendChild(option);
          });

          select.appendChild(optgroup);
        });

        // If no players were added, show "No Players"
        if (players.length === 0) {
          const option = document.createElement('option');
          option.text = "No Players";
          option.disabled = true;
          select.appendChild(option);
        }
      } else {
        console.error('Failed to fetch players');
      }
    } catch (error) {
      console.error('Error:', error);
    }
  }

  // Fetch players when the page loads
  window.onload = fetchPlayers;

  async function setRole() {
    const selectedPlayers = Array.from(document.getElementById('player-select').selectedOptions).map(option => option.value);
    const roleType = document.getElementById('role-type').value;
    const spawnLocation = document.getElementById('spawn-locations').value;
    const isCuffed = document.getElementById('is-cuffed').checked;
    let coordinates = {};

    if (spawnLocation === 'Custom') {
      coordinates = {
        x: document.getElementById('x-coordinate').value,
        y: document.getElementById('y-coordinate').value,
        z: document.getElementById('z-coordinate').value
      };
    }

    const data = {
      action: 'updatePlayer',
      players: selectedPlayers,
      roleType: roleType,
      spawnLocation: spawnLocation,
      isCuffed: isCuffed,
      coordinates: coordinates
    };

    try {
      const response = await fetch('/data', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
      });

      if (response.ok) {
        console.log('Role set successfully');
        fetchPlayers(); // Refresh player list after setting role
      } else {
        console.error('Failed to set role');
      }
    } catch (error) {
      console.error('Error:', error);
    }
  }
</script>
</body>
</html>